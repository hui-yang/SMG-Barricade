angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(){return[["","","","","","","","","W","","","","","","","",""],["0","0","0","0","0","0","0","0","1","0","0","0","0","0","0","0","0"],["0","","","","","","","","","","","","","","","","0"],["0","0","0","0","0","0","0","0","1","0","0","0","0","0","0","0","0"],["","","","","","","","","1","","","","","","","",""],["","","","","","","0","0","1","0","0","","","","","",""],["","","","","","","0","","","","0","","","","","",""],["","","","","0","0","1","0","0","0","1","0","0","","","",""],["","","","","0","","","","","","","","0","","","",""],["","","0","0","0","0","0","0","0","0","0","0","0","0","0","",""],["","","0","","","","0","","","","0","","","","0","",""],["1","0","0","0","1","0","0","0","1","0","0","0","1","0","0","0","1"],["0","","","","0","","","","0","","","","0","","","","0"],["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],["","R","R","R","","G","G","G","","","","","","","","",""],["","R","","R","","G","","G","","","","","","","","",""]]}function b(a){return a[0][8]}function c(a,b,d,e,f,g){if(0===b)return[[d,e]];if("1"===a[d][e]||0>b)return[];var h=[],i=[],j=[],k=[],l=[];return d-1>=0&&d-1!==f&&""!==a[d-1][e]&&(j=c(a,b-1,d-1,e,d,e)),13>=d+1&&d+1!==f&&""!==a[d+1][e]&&(k=c(a,b-1,d+1,e,d,e)),e-1>=0&&e-1!==g&&""!==a[d][e-1]&&(h=c(a,b-1,d,e-1,d,e)),16>=e+1&&e+1!==g&&""!==a[d][e+1]&&(i=c(a,b-1,d,e+1,d,e)),l=h.concat(i,j,k)}function d(a,b,d,e,f,g){f>=14&&(f=13,g=4*Math.floor(g/4)+2,b-=1);var h,i=c(a,b,f,g,-1,-1);for(h=0;h<i.length;h+=1)if(d===i[h][0]&&e===i[h][1])return!0;return!1}function e(a,b){var c,d="R"===b?0:"G"===b?1:"Y"===b?2:3,e=15,f=4*d+1;if("0"===a[e][f])return[e,f];if("0"===a[e][f+2])return[e,f+2];for(e-=1,c=f+3,e;c>f;f+=1)if("0"===a[e][f])return[e,f];throw new Error("Possible cheating on the number of the pawns")}function f(c,f,g,h,i,j,k){void 0===c&&(c=a());var l,m,n,o,p,q=0===k?"R":"G";if(n=b(c),"W"!==n&&"1"!==n)throw new Error("Can only make a move if the game is not over!");if(c[i][j]!==q)throw new Error("One can only move his own pawn!");if(c[g][h]===q)throw new Error("One cannot arrive on a place with his own pawn!");if(!d(c,f,g,h,i,j))throw new Error("One cannot go through a barricade or move steps different from the dice value!",f,g,h,i,j);return l=angular.copy(c),l[i][j]="0",l[g][h]=q,"0"===c[g][h]||"W"===c[g][h]?(n=b(l),m="W"!==n&&"1"!==n?{endMatch:{endMatchScores:"R"===n?[1,0]:[0,1]}}:{setTurn:{turnIndex:1-k}}):"1"===c[g][h]?(n=b(l),m="W"!==n&&"1"!==n?{endMatch:{endMatchScores:"R"===n?[1,0]:[0,1]}}:{setTurn:{turnIndex:k}}):(o=c[g][h],p=e(c,o),l[p[0]][p[1]]=o,m={setTurn:{turnIndex:1-k}}),[m,{set:{key:"type",value:"normal"}},{set:{key:"board",value:l}},{set:{key:"delta",value:{to_row:g,to_col:h,from_row:i,from_col:j}}},{set:{key:"dice",value:f}}]}function g(a,b,c,d){if(void 0===a)throw new Error("Cannot place barricade");if("0"!==a[b][c])throw new Error("One can only place barricade at an empty place!");if(b>13||0>b||0>c||c>16)throw new Error("One cannot only place barricade in the base");var e=angular.copy(a);return e[b][c]="1",[{setTurn:{turnIndex:1-d}},{set:{key:"type",value:"barricade"}},{set:{key:"board",value:e}},{set:{key:"delta",value:{to_row:b,to_col:c}}},{set:{key:"dice",value:-1}}]}function h(a,b,c,d,e,h,i,j){return"normal"===b?f(a,c,d,e,h,i,j):g(a,d,e,j)}function i(a,b){var c=[{setTurn:{turnIndex:b}},{set:{key:"type",value:"dice"}}];return void 0===a&&(a=null),c.push({setRandomInteger:{key:"dice",from:1,to:7}}),c}function j(b,c,d){return void 0===b&&(b=a()),[{setTurn:{turnIndex:1-d}},{set:{key:"type",value:"normal"}},{set:{key:"board",value:b}},{set:{key:"delta",value:{}}},{set:{key:"dice",value:c}}]}function k(a){var b,c,d,e,f,g,k,l,m,n=a.move,o=a.turnIndexBeforeMove,p=a.stateBeforeMove;try{if(b=n[1].set.value,"dice"===b){if(c=p.dice,d=i(c,o),!angular.equals(n,d))return!1}else if(e=n[3].set.value,c=n[4].set.value,f=p.board,"normal"===b&&0===Object.keys(e).length?d=j(f,c,o):(g=e.to_row,k=e.to_col,l=e.from_row,m=e.from_col,d=h(f,b,c,g,k,l,m,o)),!angular.equals(n,d))return!1}catch(q){return!1}return!0}function l(a,b,d,e){var f,g,k,l,m,n=0===e?"R":"G";if("normal"===b){for(f=0;16>f;f+=1)for(g=0;17>g;g+=1)if(a[f][g]===n){if(f>=14?(k=13,l=4*Math.floor(g/4)+2,m=c(a,d-1,k,l,-1,-1)):m=c(a,d,f,g,-1,-1),0!==m.length)return h(a,"normal",d,m[0][0],m[0][1],f,g,e);if(f>=14)break}return j(a,d,e)}if("barricade"!==b)return i(d,e);for(f=13;f>0;f-=1)for(g=0;17>g;g+=1)if("0"===a[f][g])return h(a,"barricade",d,f,g,-1,-1,e)}return{getInitialBoard:a,createMove:h,createDiceMove:i,createPassMove:j,isMoveOk:k,getRandomPossibleMove:l,getPossibleDestination:c}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","$rootScope","gameService","stateService","gameLogic","aiService","resizeGameAreaService",function(a,b,c,d,e,f,g,h,i){"use strict";function j(b,c,d){var e;b>13?(b=13,c=4*Math.floor(c/4)+2,e=g.getPossibleDestination(a.board,a.dice-1,b,c,-1,-1)):e=g.getPossibleDestination(a.board,a.dice,b,c,-1,-1);for(var f=0;f<e.length;f++)document.getElementById("e2e_test_div_"+e[f][0]+"x"+e[f][1]).style.border=d?"#0000cc 1px dashed":"none"}function k(b,c,d){var e=c-w.offsetLeft,f=d-w.offsetTop;if(0>e||0>f||e>=w.clientWidth||f>=w.clientHeight){if(!A)return;var g=n();m({top:f-g.height/2,left:e-g.width/2},a.typeExpected),"touchend"===b&&("normal"===a.typeExpected&&j(z.row,z.col,!1),"barricade"===a.typeExpected&&(A.style.display="none"))}else{var h=Math.floor(y*e/w.clientWidth),i=Math.floor(x*f/w.clientHeight);if("touchstart"!==b||z||(a.board[i][h]===a.myPiece&&a.isYourTurn&&"normal"===a.typeExpected?(z={row:i,col:h},A=document.getElementById("e2e_test_piece"+a.myPiece+"_"+i+"x"+h),A.style["z-index"]=++B,j(i,h,!0)):a.isYourTurn&&"barricade"===a.typeExpected&&(z={row:i,col:h},A=document.getElementById("spareBarricade"),m(o(i,h),"barricade"),A.style["z-index"]=60,A.style.display="inline")),!A)return;if("touchend"===b){var k=z,l={row:i,col:h};p(k,l)}else m(o(i,h),a.typeExpected)}("touchend"===b||"touchcancel"===b||"touchleave"===b)&&(m(o(z.row,z.col),a.typeExpected),"touchend"!==b&&"normal"===a.typeExpected&&j(z.row,z.col,!1),"touchend"!==b&&"barricade"===a.typeExpected&&(A.style.display="none"),z=null,A=null)}function l(b){var c=n(),d=Math.floor(b.top/c.height),e=Math.floor(b.left/c.width);return 0>d||d>13||0>e||e>16||""===a.board[d][e]}function m(a,b){var c,d=z.row,e=z.col;l(a)||(c="barricade"===b?o(0,0):o(d,e),A.style.left=a.left-c.left+"px",A.style.top=a.top-c.top+"px")}function n(){return{width:w.clientWidth/y,height:w.clientHeight/x}}function o(a,b){var c=n();return{top:a*c.height,left:b*c.width}}function p(c,f){d.$apply(function(){var d="Dragged piece "+c.row+"x"+c.col+" to square "+f.row+"x"+f.col;if(b.info(d),a.msg=d,a.isYourTurn)try{a.isYourTurn=!1,"normal"===a.typeExpected?(j(c.row,c.col,!1),e.makeMove(g.createMove(a.board,"normal",a.dice,f.row,f.col,c.row,c.col,a.turnIndex)),"1"===a.board[f.row][f.col]&&(z={row:f.row,col:f.col},A=document.getElementById("spareBarricade"),m(o(f.row,f.col),"barricade"),A.style["z-index"]=0,A.style.display="inline")):"barricade"===a.typeExpected&&(A.style.display="none",e.makeMove(g.createMove(a.board,"barricade",a.dice,f.row,f.col,-1,-1,a.turnIndex)))}catch(h){b.info(["Illegal Move",a.typeExpected,a.dice,c.row,c.col,f.row,f.col]),a.isYourTurn=!0,m(o(z.row,z.col),a.typeExpected)}})}function q(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function r(){e.makeMove(h.createComputerMove(a.board,"normal",a.dice,a.turnIndex))}function s(){e.makeMove(h.createComputerMove(a.board,"barricade",-1,a.turnIndex))}function t(){e.makeMove(g.createDiceMove(a.dice,a.turnIndex))}function u(d){var e=d.stateAfterMove.type;a.board=d.stateAfterMove.board,a.delta=d.stateAfterMove.delta,a.dice=d.stateAfterMove.dice;var f;switch(d.yourPlayerIndex){case 0:f="R";break;case 1:f="G";break;case 2:f="Y";break;case 3:f="B"}a.myPiece=f,void 0===a.board&&(a.board=g.getInitialBoard()),a.isYourTurn=d.turnIndexAfterMove>=0&&d.yourPlayerIndex===d.turnIndexAfterMove&&null===d.endMatchScores,a.turnIndex=d.turnIndexAfterMove,d.turnIndexBeforeMove!==d.turnIndexAfterMove?(a.dice=null,a.typeExpected="dice"):a.typeExpected="normal"===e?"barricade":"normal",a.isYourTurn&&""===d.playersInfo[d.yourPlayerIndex].playerId?(a.isYourTurn=!1,a.dice?"normal"===a.typeExpected?c(r,500):"barricade"===a.typeExpected&&c(s,500):c(t,500)):a.isYourTurn&&(a.dice||c(t,500));var h=document.getElementById("e2e_test_dice");if("dice"===e&&(h.className="spinIn"),"dice"===a.typeExpected&&(h.className="spinOut"),a.delta){var i,j=a.delta.from_row,k=a.delta.from_col,l=a.delta.to_row,m=a.delta.to_col,n=o(j,k),p=o(l,m);"normal"===e?(i=document.getElementById("e2e_test_piece"+f+"_"+j+"x"+k),null!==i&&(i.className="fadeout",i.style.top=n.top-p.top+"px",i.style.left=n.left-p.left+"px",i.className="slowlyAppear")):"barricade"===e&&(i=document.getElementById("e2e_test_piece1_"+l+"x"+m),null!==i?(i.style.top=n.top-p.top+"px",i.style.left=n.left-p.left+"px",i.className="slowlyAppear"):b.info(["fail to catch barricade",l,m]))}}function v(a,b,c){var d=4*a+2;return 13===b&&c===d||14===b&&(c===d-1||c===d||c===d+1)||15===b&&(c===d-1||c===d+1)}var w=document.getElementById("gameArea"),x=16,y=17,z=null,A=null,B=61;window.handleDragEvent=k,i.setWidthToHeight(1.0625),a.rows=q(x),a.cols=q(y),a.rowsNum=x,a.colsNum=y,window.e2e_test_stateService=f;var C=null,D=null;a.cellClicked=function(c,d){if("?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.isYourTurn&&a.dice)if("normal"===a.typeExpected){if(null===C||null===D)return void(a.shouldShowImage(c,d)&&"W"!==a.board[c][d]&&"0"!==a.board[c][d]&&(C=c,D=d,b.info(["Choose a pawn:",c,d])));try{a.isYourTurn=!1,b.info(["Choose a destination",c,d]),e.makeMove(g.createMove(a.board,"normal",a.dice,c,d,C,D,a.turnIndex)),C=null,D=null}catch(f){return b.info(["Illegal move to ",c,d," from ",C,D]),a.isYourTurn=!0,C=null,void(D=null)}}else if("barricade"===a.typeExpected){(null===C||null===D)&&(b.info(["Place a barricade at:",c,d]),C=null,D=null);try{a.isYourTurn=!1,b.info(["Choose a position",c,d]),e.makeMove(g.createMove(a.board,"barricade",a.dice,c,d,-1,-1,a.turnIndex))}catch(f){return b.info(["Illegal to place a barricade at:",c,d]),void(a.isYourTurn=!0)}}},a.passMove=function(){if("?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.isYourTurn&&a.dice&&"normal"===a.typeExpected)try{a.isYourTurn=!1,e.makeMove(g.createPassMove(a.board,a.dice,a.turnIndex))}catch(c){return void b.info(["Illegal pass move"])}},a.shouldShowImage=function(b,c){var d=a.board[b][c];return""!==d},a.isWinSpot=function(b,c){return"W"===a.board[b][c]},a.isPieceR=function(b,c){return"R"===a.board[b][c]},a.isPieceG=function(b,c){return"G"===a.board[b][c]},a.isPieceB=function(b,c){return"B"===a.board[b][c]},a.isPieceY=function(b,c){return"Y"===a.board[b][c]},a.isBarricade=function(b,c){return"1"===a.board[b][c]},a.isEmptySpot=function(b,c){return"0"===a.board[b][c]},a.isRedStart=function(a,b){return v(0,a,b)},a.isGreenStart=function(a,b){return v(1,a,b)},a.isYellowStart=function(a,b){return v(2,a,b)},a.isBlueStart=function(a,b){return v(3,a,b)},a.isNormalSpot=function(b,c){return!(a.isWinSpot(b,c)||a.isRedStart(b,c)||a.isGreenStart(b,c)||a.isYellowStart(b,c)||a.isBlueStart(b,c))},a.getDiceSrc=function(){switch(a.dice){case 1:return"imgs/1.png";case 2:return"imgs/2.png";case 3:return"imgs/3.png";case 4:return"imgs/4.png";case 5:return"imgs/5.png";case 6:return"imgs/6.png";default:return""}},a.shouldSlowlyAppear=function(b,c){return void 0!==a.delta&&a.delta.to_row===b&&a.delta.to_col===c},e.setGame({gameDeveloperEmail:"hy821@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:u})}]),angular.module("myApp").factory("aiService",["gameLogic",function(a){"use strict";function b(a,b){for(var c=0;16>c;c+=1)for(var d=0;17>d;d+=1)if(a[c][d]===b)return[c,d]}function c(a,b,c,f){return"normal"===b?d(a,c,f):e(a,f)}function d(b,c,d){for(var e=0===d?"R":"G",h=f(b,e),i=[],j=[],k=[],l=0;l<h.length;l++){var m,n=h[l][0],o=h[l][1];if(n>13){var p=13,q=4*Math.floor(o/4)+2;m=a.getPossibleDestination(b,c-1,p,q,-1,-1)}else m=a.getPossibleDestination(b,c,n,o,-1,-1);for(var r=0;r<m.length;r++){var s=m[r],t={from:h[l],to:s};switch(b[s[0]][s[1]]){case"1":i.push(t);break;case"W":return a.createMove(b,"normal",c,0,8,n,o,d);case e:break;case"0":k.push(t);break;default:j.push(t)}}if(n>13)break}var u;if(0!==i.length)u=g(i,c);else if(0!==j.length)u=g(j,c);else{if(0===k.length)return a.createPassMove(b,c,d);u=g(k,c)}return a.createMove(b,"normal",c,u.to[0],u.to[1],u.from[0],u.from[1],d)}function e(c,d){var e,f,g=0===d?"R":"G",h=0===d?"G":"R",i=b(c,g),j=b(c,h);if(j[0]>13){if("G"===h){for(e=13;e>0;e-=1)for(f=j[1];f<j[1]+2;f+=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d)}else if("R"===h)for(e=13;e>0;e-=1)for(f=0;4>f;f+=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d)}else if(i[0]<j[0]){for(e=i[0]+1;14>e;e+=1)for(f=0;17>f;f+=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d)}else if(i[0]>j[0]){for(e=j[0]-1;e>0;e-=1)for(f=0;17>f;f+=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d);for(e=j[0],f=0;17>f;f+=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d)}else if(i[1]<j[1])if(1===i[0]&&j[1]<8){for(e=1;14>e;e+=1)for(f=j[1]+1;17>f;f+=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d)}else for(e=1;14>e;e+=1){for(f=j[1]-1;f>i[1];f-=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d);for(f=j[1]+1;17>f;f+=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d)}else if(1===i[0]&&j[1]>8){for(e=1;14>e;e+=1)for(f=j[1]-1;f>=0;f-=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d)}else for(e=j[0];e>0;e-=1){for(f=j[1]+1;f<i[1];f+=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d);for(f=j[1]-1;f>=0;f-=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d)}for(e=1;14>e;e+=1)for(f=0;17>f;f+=1)if("0"===c[e][f])return a.createMove(c,"barricade",-1,e,f,-1,-1,d)}function f(a,b){for(var c=[],d=0;16>d;d+=1)for(var e=0;17>e;e+=1)a[d][e]===b&&c.push([d,e]);if(5!==c.length)throw new Error("Cheating on pieces");return c}function g(a,b){for(var c,d,e=0;e<a.length;e++){var f=a[e],g=f.from,h=f.to,i=1-h[0]/16+(g[0]-h[0])/b+(g[0]>13?.5:0);(!c||i>c)&&(c=i,d=f)}return d}return{createComputerMove:c}}]);
//# sourceMappingURL=everything.min.js.map